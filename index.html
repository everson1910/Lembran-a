<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Raspadinha</title>

  <style>
    * { box-sizing: border-box; }

    html, body { height: 100%; margin: 0; }

    body{
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: #0b1220;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: clamp(10px, 2.5vw, 18px);
    }

    /* CARD RESPONSIVO REAL */
    .stage{
      position: relative;
      width: min(96vw, 520px);
      height: min(92svh, 860px);
      border-radius: clamp(16px, 3vw, 22px);
      overflow: hidden;
      background: #111827;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
    }

    @media (max-height: 520px){
      .stage{
        height: 96svh;
        border-radius: 14px;
      }
    }

    /* IMAGEM NO FUNDO */
    .bg{
      position:absolute;
      inset:0;
      background: url("img.jpeg") center top / cover no-repeat;
    }

    /* CANVAS */
    #scratch{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      display:block;
    }

    /* HINT */
    .hint{
      position:absolute;
      left:14px; right:14px; top:14px;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.92);
      font-weight:700;
      backdrop-filter: blur(8px);
      z-index: 5;
      text-align: center;
    }

    /* MODAL FINAL */
    .win{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:0;
      pointer-events:none;
      transition: opacity .35s ease;
      z-index: 6;
    }
    .win.show{ opacity:1; }

    .card{
      text-align:center;
      color:#fff;
      padding:16px 20px;
      border-radius:18px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      font-size: clamp(18px, 4vw, 22px);
    }

    /* CORAÃ‡Ã•ES */
    .heart{
      position:absolute;
      font-size:22px;
      animation: heart-burst 1400ms ease-out forwards;
      pointer-events:none;
      z-index: 7;
    }

    @keyframes heart-burst{
      from{ transform: translate(0,0) scale(1); opacity:1; }
      to{ transform: translate(var(--dx), var(--dy)) scale(1.8); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="stage" id="stage">
    <div class="bg"></div>
    <div class="hint" id="hint">Raspe toda a imagem ðŸ‘†</div>
    <canvas id="scratch"></canvas>

    <div class="win" id="win">
      <div class="card">ðŸ’–</div>
    </div>
  </div>

  <script>
    const stage = document.getElementById("stage");
    const canvas = document.getElementById("scratch");
    const ctx = canvas.getContext("2d", { willReadFrequently: true });
    const hint = document.getElementById("hint");
    const win = document.getElementById("win");

    let isDown = false;
    let done = false;
    let last = null;

    const BRUSH_RADIUS = 48;

   function resize() {
  const rect = stage.getBoundingClientRect();
  const dpr = Math.max(1, window.devicePixelRatio || 1);

  canvas.style.width = rect.width + "px";     // <<< ADD
  canvas.style.height = rect.height + "px";   // <<< ADD

  canvas.width = Math.floor(rect.width * dpr);
  canvas.height = Math.floor(rect.height * dpr);

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  drawCover(Math.round(rect.width), Math.round(rect.height));
  done = false;
  win.classList.remove("show");
  hint.style.display = "block";
}


    function drawCover(w, h) {
      ctx.globalCompositeOperation = "source-over";
      ctx.clearRect(0, 0, w, h);
      ctx.fillStyle = "#9CA3AF";
      ctx.fillRect(0, 0, w, h);

      const imgData = ctx.getImageData(0, 0, w, h);
      const d = imgData.data;
      for (let i = 0; i < d.length; i += 4) {
        const n = (Math.random() * 35) | 0;
        d[i] += n; d[i+1] += n; d[i+2] += n;
      }
      ctx.putImageData(imgData, 0, 0);

      ctx.fillStyle = "rgba(0,0,0,.28)";
      ctx.font = "800 24px system-ui";
      ctx.textAlign = "center";
      ctx.fillText("RASPE AQUI", w/2, h/2);
    }

    function getPos(e) {
      const r = canvas.getBoundingClientRect();
      const t = e.touches?.[0] || e.changedTouches?.[0];
      return {
        x: (t ? t.clientX : e.clientX) - r.left,
        y: (t ? t.clientY : e.clientY) - r.top
      };
    }

    function scratchLine(x1, y1, x2, y2) {
      if (done) return;
      hint.style.display = "none";
      ctx.globalCompositeOperation = "destination-out";
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.lineWidth = BRUSH_RADIUS * 2;

      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();
    }

    function scratchedPercent() {
      const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      let t = 0, total = 0;
      for (let i = 3; i < data.length; i += 80) {
        total++;
        if (data[i] === 0) t++;
      }
      return t / total;
    }

    function finish() {
      done = true;
      ctx.globalCompositeOperation = "destination-out";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      win.classList.add("show");
      heartsExplosion();
    }

    function heartsExplosion() {
      const r = stage.getBoundingClientRect();
      const cx = r.width / 2;
      const cy = r.height / 2;

      const hearts = ["â¤ï¸","â¤ï¸","â¤ï¸","â¤ï¸","â¤ï¸"];
      const start = Date.now();

      const timer = setInterval(() => {
        if (Date.now() - start > 5000) {
          clearInterval(timer);
          return;
        }

        for (let i = 0; i < 18; i++) {
          const h = document.createElement("div");
          h.className = "heart";
          h.textContent = hearts[0];
          h.style.left = cx + "px";
          h.style.top = cy + "px";

          const a = Math.random() * Math.PI * 2;
          const d = 140 + Math.random() * 260;
          h.style.setProperty("--dx", Math.cos(a) * d + "px");
          h.style.setProperty("--dy", Math.sin(a) * d + "px");

          stage.appendChild(h);
          h.addEventListener("animationend", () => h.remove(), { once:true });
        }
      }, 120);
    }

    function down(e){ if(done) return; isDown=true; last=getPos(e); scratchLine(last.x,last.y,last.x,last.y); }
    function move(e){
      if(!isDown||done) return;
      e.preventDefault();
      const p=getPos(e);
      scratchLine(last.x,last.y,p.x,p.y);
      last=p;
      if(scratchedPercent()>0.95) finish();
    }
    function up(){ isDown=false; last=null; }

    stage.addEventListener("mousedown", down);
    window.addEventListener("mousemove", move, { passive:false });
    window.addEventListener("mouseup", up);

    stage.addEventListener("touchstart", down, { passive:false });
    stage.addEventListener("touchmove", move, { passive:false });
    stage.addEventListener("touchend", up);

    window.addEventListener("resize", resize);
    resize();
  </script>
</body>
</html>
